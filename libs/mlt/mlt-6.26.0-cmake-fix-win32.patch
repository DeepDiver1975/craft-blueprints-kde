From 31e1b725e0e05a92e585810f2773e503dbd24027 Mon Sep 17 00:00:00 2001
From: Vincent Pinon <vpinon@kde.org>
Date: Mon, 12 Apr 2021 13:55:14 +0200
Subject: [PATCH] fix win32 build

---
 src/modules/CMakeLists.txt         | 2 +-
 src/modules/core/CMakeLists.txt    | 1 +
 src/modules/rtaudio/CMakeLists.txt | 1 +
 3 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/modules/CMakeLists.txt b/src/modules/CMakeLists.txt
index 45e57803..dc8b206f 100644
--- a/src/modules/CMakeLists.txt
+++ b/src/modules/CMakeLists.txt
@@ -20,7 +20,7 @@ if(MOD_GDK AND TARGET PkgConfig::GdkPixbuf)
   add_subdirectory(gdk)
 endif()
 
-if(MOD_GTK2)
+if(MOD_GTK2 AND TARGET GTK2::gtk)
   add_subdirectory(gtk2)
 endif()
 
diff --git a/src/modules/core/CMakeLists.txt b/src/modules/core/CMakeLists.txt
index dca1acc5..556ca6d5 100644
--- a/src/modules/core/CMakeLists.txt
+++ b/src/modules/core/CMakeLists.txt
@@ -47,6 +47,7 @@ target_link_libraries(mltcore mlt Threads::Threads)
 
 if(WIN32)
   target_sources(mltcore PRIVATE ../../win32/fnmatch.c)
+  target_include_directories(mltcore PRIVATE ../../win32)
 endif()
 
 if(X86_64)
diff --git a/src/modules/rtaudio/CMakeLists.txt b/src/modules/rtaudio/CMakeLists.txt
index ee2c85f6..f11112c3 100644
--- a/src/modules/rtaudio/CMakeLists.txt
+++ b/src/modules/rtaudio/CMakeLists.txt
@@ -5,6 +5,7 @@ if(TARGET PkgConfig::rtaudio)
   target_link_libraries(mltrtaudio PkgConfig::rtaudio)
 else()
   target_sources(mltrtaudio PRIVATE RtAudio.cpp)
+  target_include_directories(mltrtaudio PRIVATE .)
   if(APPLE)
     target_link_libraries(mltrtaudio CoreAudio CoreFoundation)
     target_compile_definitions(mltrtaudio PRIVATE __MACOSX_CORE__)
-- 
2.30.1

