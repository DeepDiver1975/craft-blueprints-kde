From de40407db991cd6af431dddedfe5f16c6f57b110 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Julius=20K=C3=BCnzel?= <jk.kdedev@smartlab.uber.space>
Date: Sat, 27 Jan 2024 21:45:14 +0000
Subject: [PATCH 1/4] [CI/CD] Add macOS jobs

In preparation of Binary Factory shutdown
---
 .gitlab-ci.yml | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/.gitlab-ci.yml b/.gitlab-ci.yml
index 0722a6da7..3a8d108ba 100644
--- a/.gitlab-ci.yml
+++ b/.gitlab-ci.yml
@@ -10,3 +10,5 @@ include:
       - /gitlab-templates/windows-qt6.yml
       - /gitlab-templates/flatpak.yml
       - /gitlab-templates/craft-windows-x86-64-qt6.yml
+      - /gitlab-templates/craft-macos-arm64-qt6.yml
+      - /gitlab-templates/craft-macos-x86-64-qt6.yml
\ No newline at end of file
-- 
GitLab


From 7bbcc32b804c91aac73106c9533bacc44fdf6f23 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Julius=20K=C3=BCnzel?= <jk.kdedev@smartlab.uber.space>
Date: Sat, 24 Feb 2024 21:52:56 +0000
Subject: [PATCH 2/4] Don't use KGlobalAccel on macOS

---
 CMakeLists.txt      | 6 +++---
 src/Application.cpp | 4 ++--
 src/CMakeLists.txt  | 2 +-
 3 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 22f5c96aa..c1c292f12 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -74,7 +74,7 @@ find_package(KF6 ${KF5_DEP_VERSION} REQUIRED
     XmlGui
 )
 
-if (NOT WIN32)
+if (NOT WIN32 AND NOT APPLE)
     find_package(KF6 ${KF5_DEP_VERSION} REQUIRED
         GlobalAccel
         Pty
@@ -125,8 +125,8 @@ add_subdirectory( src )
 add_subdirectory( data )
 add_subdirectory( desktop )
 
-if (NOT WIN32)
-add_subdirectory( kconf_update )
+if (NOT WIN32 AND NOT APPLE)
+    add_subdirectory( kconf_update )
 endif()
 
 if (KF6DocTools_FOUND)
diff --git a/src/Application.cpp b/src/Application.cpp
index 3ea83952d..95bbb2784 100644
--- a/src/Application.cpp
+++ b/src/Application.cpp
@@ -18,7 +18,7 @@
 
 // KDE
 #include <KActionCollection>
-#ifndef Q_OS_WIN
+#if !defined(Q_OS_WIN) && !defined(Q_OS_MACOS)
 #include <KGlobalAccel>
 #endif
 #include <KLocalizedString>
@@ -507,7 +507,7 @@ void Application::startBackgroundMode(MainWindow *window)
         return;
     }
 
-#ifndef Q_OS_WIN
+#if !defined(Q_OS_WIN) && !defined(Q_OS_MACOS)
     KActionCollection *collection = window->actionCollection();
     QAction *action = collection->addAction(QStringLiteral("toggle-background-window"));
     action->setObjectName(QStringLiteral("Konsole Background Mode"));
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 64c7aa916..07fa2ca31 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -74,7 +74,7 @@ set(konsole_LIBS
     KF6::NewStuffCore
 )
 
-if (NOT WIN32)
+if (NOT WIN32 AND NOT APPLE)
     list(APPEND konsole_LIBS
         KF6::Pty
         KF6::GlobalAccel
-- 
GitLab


From c0f2d26377a971c07ba2e06cd579bb86a7525a9a Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Julius=20K=C3=BCnzel?= <jk.kdedev@smartlab.uber.space>
Date: Sat, 24 Feb 2024 22:03:12 +0000
Subject: [PATCH 3/4] Don't disable Pty on macOS

---
 CMakeLists.txt     | 7 ++++++-
 src/CMakeLists.txt | 7 ++++++-
 2 files changed, 12 insertions(+), 2 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index c1c292f12..5168e8697 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -74,10 +74,15 @@ find_package(KF6 ${KF5_DEP_VERSION} REQUIRED
     XmlGui
 )
 
+if (NOT WIN32)
+    find_package(KF6 ${KF5_DEP_VERSION} REQUIRED
+        Pty
+    )
+endif()
+
 if (NOT WIN32 AND NOT APPLE)
     find_package(KF6 ${KF5_DEP_VERSION} REQUIRED
         GlobalAccel
-        Pty
     )
 endif()
 
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 07fa2ca31..4474ceb8d 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -74,9 +74,14 @@ set(konsole_LIBS
     KF6::NewStuffCore
 )
 
-if (NOT WIN32 AND NOT APPLE)
+if (NOT WIN32)
     list(APPEND konsole_LIBS
         KF6::Pty
+    )
+endif()
+
+if (NOT WIN32 AND NOT APPLE)
+    list(APPEND konsole_LIBS
         KF6::GlobalAccel
     )
 endif()
-- 
GitLab


From 61264c1917770102a85123d388528f2bcacfd960 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Julius=20K=C3=BCnzel?= <jk.kdedev@smartlab.uber.space>
Date: Sat, 24 Feb 2024 22:30:08 +0000
Subject: [PATCH 4/4] Fix compile error on macOS

---
 src/session/SessionController.cpp | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/session/SessionController.cpp b/src/session/SessionController.cpp
index dc1308f53..2b28b87b4 100644
--- a/src/session/SessionController.cpp
+++ b/src/session/SessionController.cpp
@@ -767,8 +767,8 @@ void SessionController::setupCommonActions()
     _findPreviousAction->setEnabled(false);
 
 #ifdef Q_OS_MACOS
-    collection->setDefaultShortcut(_findAction, Qt::CTRL | Qt::Key_F);
-    collection->setDefaultShortcut(_findNextAction, Qt::CTRL | Qt::Key_G);
+    collection->setDefaultShortcut(_findAction, QKeySequence(Qt::CTRL | Qt::Key_F));
+    collection->setDefaultShortcut(_findNextAction, QKeySequence(Qt::CTRL | Qt::Key_G));
     collection->setDefaultShortcut(_findPreviousAction, Qt::CTRL | Qt::SHIFT | Qt::Key_G);
 #else
     collection->setDefaultShortcut(_findAction, Qt::CTRL | Qt::SHIFT | Qt::Key_F);
-- 
GitLab

